.am-panel.am-panel-default
  .am-panel-hd
  .am-panel-bd
    .am-form#acpwdModel
      .am-form-group
        label 原密码:
        input(type="password" data-bind="value: oldpwd")
        p.am-alert-danger(data-bind="validationMessage: oldpwd")
      .am-form-group
        label 新密码:
        input(type="password" data-bind="value: newpwd")
        p.am-alert-danger(data-bind="validationMessage: newpwd")
      .am-form-group
        label 请再次输入新密码:
        input(type="password" data-bind="value: newpwdre")
        p.am-alert-danger(data-bind="validationMessage: newpwdre")
      .am-navbar.am-cf.am-navbar-default(data-am-widget="navbar")
        ul.am-navbar-nav.am-cf.am-avg-sm-4
          li
            a(data-bind="click: acpwdSave")
              span.am-icon-save
              span.am-navbar-label 保 存
script.
  function pwdvm() {
    var self = this;
    self.oldpwd = ko.observable().extend({ required: true, minLength: 3, maxLength: 64 });
    self.newpwd = ko.observable().extend({ required: true, minLength: 3, maxLength: 64 });
    self.newpwdre = ko.observable().extend({ equal: self.newpwd });

    self.getjson = function () {
      if (self.isValid()) {
        var dv = new Object();
        dv.username = $.AMUI.utils.cookie.get('uid');
        dv.oldpwd = self.oldpwd();
        dv.newpwd = self.newpwd();
        return JSON.stringify(dv);
      } else {
        $("#msg").html("数据验证失败！");
        $('#my-prompt').modal('open');
      }
    };

    self.acpwdSave = function () {
      if (self.isValid()) {
        var uri = "/index.php/useredit" ;//+ $.AMUI.utils.cookie.get('uid');
        $.ajax({
          type: "POST",
          url: uri,
          data: self.getjson(),
          beforeSend: function (xhr) {
            xhr.setRequestHeader("Content-Type", "application/json")
          },
          success: function (result) {
            // if (result === "") {
            // $.AMUI.utils.cookie.set('ukey', null);
            $.AMUI.utils.cookie.set('uid', null);
            $.AMUI.utils.cookie.set('pwd', null);
            $("#msg").html("password update successful!");
            $('#my-prompt').modal('open');
            window.location = "index.html";

          },
          error: function (xhr, status, error) {
            $("#msg").html(xhr.responseText);
            $('#my-prompt').modal('open');
          }
        });
      } else {
        $("#msg").html("数据验证失败！");
        $('#my-prompt').modal('open');
      }
    };
  }
  ko.applyBindings(ko.validatedObservable(new pwdvm()), document.getElementById("acpwdModel"));
  mainmodel.showback(true);