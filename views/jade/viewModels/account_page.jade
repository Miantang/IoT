.am-panel.am-panel-default
  .am-panel-hd
  .am-panel-bd
    .am-form#acModel
      label 用户名:
      input(type="text" data-bind="value: uid" readonly)
      p.am-form-help 用户名不可修改
      label 用户姓名:
      input(type="text" data-bind="value: username")
      label 电子邮件地址:
      input(type="text" data-bind="value: email")
      label QQ号:
      input(type="text" data-bind="value: qq")

      .am-navbar.am-cf.am-navbar-default
        ul.am-navbar-nav.am-cf.am-avg-sm-4
          li
            a(data-bind="click: acSave")
              span.am-icon-save
              span.am-navbar-label 保 存
script.
  $.ajax({
    url: "/user",
    data : {"username" : $.AMUI.utils.cookie.get('uid')}
  }).done(function (data) {
    function acViewModel() {
      var self = this;
      self.username = ko.observable(data.username).extend({ required: true, minLength: 3, maxLength: 64 });
      self.realname = ko.observable(data.realname).extend({ required: true, minLength: 3, maxLength: 64 });
      self.email = ko.observable(data.email).extend({ required: true, minLength: 3, maxLength: 64 });
      self.qq = ko.observable(data.qq).extend({ required: true, minLength: 3, maxLength: 64 });

      self.getjson = function () {
        if (self.isValid()) {
          var dv = new Object();
          dv.username = self.username();
          dv.uid = self.uid();
          dv.email = self.email();
          dv.qq = self.qq();
          return JSON.stringify(dv);
        } else {
          $("#msg").html("数据验证失败！");
          $('#my-prompt').modal('open');
        }
      };

      self.acSave = function () {
        $.ajax({
          type: "POST",
          url: "/user",
          data: self.getjson(),
          beforeSend: function (xhr) {
            xhr.setRequestHeader("Content-Type", "application/json")
          },
          success: function (result) {
            if (result === "") {
              $("#msg").html("保存完成！");
              $('#my-prompt').modal('open');
            } else {
              $("#msg").html(result);
              $('#my-prompt').modal('open');
            }
          },
          error: function (xhr, status, error) {
            $("#msg").html(xhr.responseText);
            $('#my-prompt').modal('open');
          }
        });
      };

    }
    var aavm = new acViewModel();
    ko.applyBindings(ko.validatedObservable(aavm), document.getElementById("acModel"));
  });
  mainmodel.showback(true);
